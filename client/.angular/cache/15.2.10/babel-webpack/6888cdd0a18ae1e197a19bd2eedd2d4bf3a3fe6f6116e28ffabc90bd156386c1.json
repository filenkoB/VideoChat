{"ast":null,"code":"import _asyncToGenerator from \"D:/\\u041B\\u0430\\u0431\\u043A\\u0438/Semantic/FootballGuide/VideoChat/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nexport class ConferencePeer {\n  get localDescription() {\n    return this._peer.localDescription;\n  }\n  constructor(_input, _output, _sharingStream) {\n    this._input = _input;\n    this._output = _output;\n    this._sharingStream = _sharingStream;\n    this._peerConnectionConfig = {\n      iceServers: [{\n        urls: \"stun:stun.services.mozilla.com\"\n      }, {\n        urls: \"stun:stun.l.google.com:19302\"\n      }, {\n        urls: \"stun:stun.awt.be:3478\"\n      }, {\n        urls: \"stun:stun.b2b2c.ca:3478\"\n      }, {\n        urls: \"stun:stun.bahnhof.net:3478\"\n      }, {\n        urls: \"stun:stun.barracuda.com:3478\"\n      }, {\n        urls: \"stun:stun.bluesip.net:3478\"\n      }, {\n        urls: \"stun:stun.bmwgs.cz:3478\"\n      }, {\n        urls: \"stun:stun.botonakis.com:3478\"\n      }, {\n        urls: \"stun:stun.budgetphone.nl:3478\"\n      }, {\n        urls: \"stun:stun.cablenet-as.net:3478\"\n      }]\n    };\n    this._initPeer();\n  }\n  _onTrack(event) {\n    if (!this._participantStreamId) {\n      this._participantStreamId = event.streams[0].id;\n    }\n    let stream = event.streams[0];\n    let tracks = event.streams[0].getTracks();\n    if (stream.id === this._participantStreamId) {\n      tracks.forEach(track => {\n        this._output.addTrack(track);\n      });\n    } else {\n      event.streams[0].getTracks().forEach(track => {\n        this._sharingStream.addTrack(track);\n      });\n    }\n  }\n  _initPeer() {\n    this._peer = new RTCPeerConnection(this._peerConnectionConfig);\n    this._input.getTracks().forEach(track => {\n      this._peer.addTrack(track, this._input);\n    });\n    this._sharingStream.getTracks().forEach(track => {\n      this._peer.addTrack(track, this._sharingStream);\n    });\n    this._peer.ontrack = this._onTrack.bind(this);\n  }\n  onCandidate() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      return new Promise((resolve, reject) => {\n        _this._peer.onicecandidate = event => {\n          if (event.candidate != null) {\n            resolve(event);\n          }\n        };\n      });\n    })();\n  }\n  createOffer() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      return _this2._peer?.createOffer();\n    })();\n  }\n  removeTrack(track) {\n    let sender = this._peer?.getSenders().find(s => s.track.id === track.id);\n    this._peer?.removeTrack(sender);\n  }\n  createAnswer() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      return _this3._peer?.createAnswer();\n    })();\n  }\n  setLocalDescription(description) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      return _this4._peer?.setLocalDescription(description);\n    })();\n  }\n  addTrack(track, ...streams) {\n    return this._peer?.addTrack(track, ...streams);\n  }\n  setRemoteDescription(description) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      return _this5._peer?.setRemoteDescription(description);\n    })();\n  }\n  addIceCandidate(candidate) {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      return _this6._peer?.addIceCandidate(candidate);\n    })();\n  }\n  close() {\n    this._peer?.close();\n  }\n}","map":{"version":3,"mappings":"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","names":["ConferencePeer","localDescription","_peer","constructor","_input","_output","_sharingStream","iceServers","urls","_initPeer","_onTrack","event","_participantStreamId","streams","id","stream","tracks","getTracks","forEach","track","addTrack","RTCPeerConnection","_peerConnectionConfig","ontrack","bind","onCandidate","Promise","resolve","reject","onicecandidate","candidate","createOffer","removeTrack","sender","getSenders","find","s","createAnswer","setLocalDescription","description","setRemoteDescription","addIceCandidate","close"],"sourceRoot":"","sources":["D:\\Лабки\\Semantic\\FootballGuide\\VideoChat\\client\\src\\model\\conference-peer.ts"],"sourcesContent":["export class ConferencePeer {\r\n    private readonly _peerConnectionConfig =  {\r\n        iceServers: [\r\n          { urls: \"stun:stun.services.mozilla.com\" },\r\n          { urls: \"stun:stun.l.google.com:19302\" },\r\n          { urls: \"stun:stun.awt.be:3478\" },\r\n          { urls: \"stun:stun.b2b2c.ca:3478\" },\r\n          { urls: \"stun:stun.bahnhof.net:3478\" },\r\n          { urls: \"stun:stun.barracuda.com:3478\" },\r\n          { urls: \"stun:stun.bluesip.net:3478\" },\r\n          { urls: \"stun:stun.bmwgs.cz:3478\" },\r\n          { urls: \"stun:stun.botonakis.com:3478\" },\r\n          { urls: \"stun:stun.budgetphone.nl:3478\" },\r\n          { urls: \"stun:stun.cablenet-as.net:3478\" }\r\n        ]\r\n    };\r\n\r\n    private _peer?: RTCPeerConnection;\r\n\r\n    private _participantStreamId?: string;\r\n\r\n    public get localDescription() : RTCSessionDescription {\r\n        return this._peer!.localDescription!;\r\n    }\r\n\r\n    constructor(\r\n        private readonly _input: MediaStream,\r\n        private _output: MediaStream,\r\n        private _sharingStream: MediaStream\r\n    ) {\r\n        this._initPeer();\r\n    }\r\n\r\n    private _onTrack(event: RTCTrackEvent) {\r\n        if (!this._participantStreamId) {\r\n            this._participantStreamId = event.streams[0].id;\r\n        }\r\n        let stream = event.streams[0];\r\n        let tracks = event.streams[0].getTracks();\r\n        if (stream.id === this._participantStreamId) {\r\n            tracks.forEach(track => {\r\n                this._output.addTrack(track);\r\n            });\r\n        } else {\r\n            event.streams[0].getTracks().forEach(track => {\r\n                this._sharingStream.addTrack(track);\r\n            });\r\n        }\r\n    } \r\n\r\n    private _initPeer() {\r\n        this._peer = new RTCPeerConnection(this._peerConnectionConfig);\r\n        this._input.getTracks().forEach((track) => {\r\n            this._peer!.addTrack(track, this._input);\r\n        });\r\n        this._sharingStream.getTracks().forEach((track) => {\r\n            this._peer!.addTrack(track, this._sharingStream);\r\n        });\r\n\r\n        this._peer.ontrack = this._onTrack.bind(this);\r\n    }\r\n\r\n    public async onCandidate(): Promise<RTCPeerConnectionIceEvent> {\r\n        return new Promise((resolve, reject) => {\r\n            this._peer!.onicecandidate = (event) => {\r\n                if (event.candidate != null) {\r\n                    resolve(event);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public async createOffer(): Promise<RTCSessionDescriptionInit> {\r\n        return this._peer?.createOffer()!;\r\n    }\r\n\r\n    public removeTrack(track: MediaStreamTrack): void {\r\n        let sender = this._peer?.getSenders().find(s => s!.track!.id === track.id);\r\n        this._peer?.removeTrack(sender!);\r\n    }\r\n\r\n    public async createAnswer(): Promise<RTCSessionDescriptionInit> {\r\n        return this._peer?.createAnswer()!;\r\n    }\r\n\r\n    public async setLocalDescription(description: any): Promise<void> {\r\n        return this._peer?.setLocalDescription(description);\r\n    }\r\n\r\n    public addTrack(track: MediaStreamTrack, ...streams: MediaStream[]): RTCRtpSender {\r\n        return this._peer?.addTrack(track, ...streams)!;\r\n    }\r\n\r\n    public async setRemoteDescription(description: any): Promise<void> {\r\n        return this._peer?.setRemoteDescription(description)!;\r\n    }\r\n\r\n    public async addIceCandidate(candidate: RTCIceCandidateInit): Promise<void> {\r\n        return this._peer?.addIceCandidate(candidate)!;\r\n    }\r\n\r\n    public close(): void {\r\n        this._peer?.close();\r\n    }\r\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}