{"ast":null,"code":"import { ParticipantComponent } from '../participant/participant.component';\nimport { Subscription } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/service/conference.service\";\nimport * as i2 from \"src/service/rtc.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../participant/participant.component\";\nimport * as i5 from \"../input-controls/input-controls.component\";\nconst _c0 = [\"controls\"];\nfunction ConferenceMainComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelement(1, \"app-participant\", 5);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const participant_r2 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"participant\", participant_r2);\n  }\n}\nexport let ConferenceMainComponent = /*#__PURE__*/(() => {\n  class ConferenceMainComponent {\n    constructor(_conferenceService, _rtcService) {\n      this._conferenceService = _conferenceService;\n      this._rtcService = _rtcService;\n      this._subscriptions = new Subscription();\n      this.participants = [];\n      this.userId = crypto.randomUUID();\n      this.userName = this._getNameFromCookies();\n      this._initEvents();\n    }\n    _initEvents() {\n      this._subscriptions.add(this._conferenceService.onConnected$.subscribe(() => {\n        console.log(`Id: ${this.userId} Name: ${this.userName} - connected succesfully`);\n        this._conferenceService.getParticipants();\n      }));\n      this._subscriptions.add(this._conferenceService.getParticipants$.subscribe(participants => {\n        this.participants = participants;\n      }));\n      this._subscriptions.add(this._conferenceService.onNewConnection$.subscribe(participant => {\n        this.participants.push(participant);\n      }));\n      this._subscriptions.add(this._conferenceService.onRemoveConnection$.subscribe(participant => {\n        let index = this.participants.findIndex(p => p.id === participant.id);\n        this.participants.splice(index, 1);\n      }));\n      this._subscriptions.add(this._conferenceService.onToggleMicrophone$.subscribe(event => {\n        let participantCmp = this.participantElements.find(c => c.participant.id === event.userId);\n        if (participantCmp) {\n          participantCmp.isMicroActive = event.isActive;\n        }\n      }));\n      this._subscriptions.add(this._conferenceService.onSendSignal$.subscribe(signal => {\n        //this._rtcService.signalPeer()\n      }));\n    }\n    _getNameFromCookies() {\n      let matches = document.cookie.match(new RegExp(\"(?:^|; )\" + \"name\".replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + \"=([^;]*)\"));\n      return decodeURIComponent(matches[1]);\n    }\n    ngOnInit() {\n      this._conferenceService.startConnection(this.userId, this.userName);\n    }\n    ngAfterViewChecked() {\n      if (this.participantElements) {\n        this.inputControls.currentParticipant = this.participantElements.first;\n      }\n    }\n    ngOnDestroy() {\n      this._subscriptions.unsubscribe();\n    }\n    static #_ = this.ɵfac = function ConferenceMainComponent_Factory(t) {\n      return new (t || ConferenceMainComponent)(i0.ɵɵdirectiveInject(i1.ConferenceService), i0.ɵɵdirectiveInject(i2.RtcService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ConferenceMainComponent,\n      selectors: [[\"app-conference-main\"]],\n      viewQuery: function ConferenceMainComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n          i0.ɵɵviewQuery(ParticipantComponent, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.inputControls = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.participantElements = _t);\n        }\n      },\n      decls: 5,\n      vars: 1,\n      consts: [[\"id\", \"conference-container\"], [\"id\", \"participants-container\"], [\"class\", \"participant\", 4, \"ngFor\", \"ngForOf\"], [\"controls\", \"\"], [1, \"participant\"], [3, \"participant\"]],\n      template: function ConferenceMainComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n          i0.ɵɵtemplate(2, ConferenceMainComponent_div_2_Template, 2, 1, \"div\", 2);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(3, \"app-input-controls\", null, 3);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.participants);\n        }\n      },\n      dependencies: [i3.NgForOf, i4.ParticipantComponent, i5.InputControlsComponent],\n      styles: [\"#conference-container[_ngcontent-%COMP%]{width:100%;height:100%;padding:2% 5% 0;background-color:#1b1919d8}#conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:5px;width:100%;height:90%}#conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]:first-child:nth-last-child(1), #conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]:first-child:nth-last-child(1) ~ *[_ngcontent-%COMP%]{flex:0 0 100%}#conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]{flex:0 0 calc((100% - 10px) / 3);background-color:#656565c3;border-radius:5px;box-shadow:1px 1px 5px #171717}#conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]:first-child:nth-last-child(2), #conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]:first-child:nth-last-child(2) ~ *[_ngcontent-%COMP%], #conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]:first-child:nth-last-child(4), #conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]:first-child:nth-last-child(4) ~ *[_ngcontent-%COMP%]{flex:0 0 calc((100% - 5px)/2)}#conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]:first-child:nth-last-child(8), #conference-container[_ngcontent-%COMP%]   #participants-container[_ngcontent-%COMP%]   .participant[_ngcontent-%COMP%]:first-child:nth-last-child(8) ~ *[_ngcontent-%COMP%]{flex:0 0 calc((100% - 15px)/4)}\"]\n    });\n  }\n  return ConferenceMainComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}