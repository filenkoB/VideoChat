{"ast":null,"code":"import { Subject } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nexport class RtcService {\n  constructor() {\n    this._onSignal = new Subject();\n    this.onSignal$ = this._onSignal.asObservable();\n    this._onStream = new Subject();\n    this.onStream = this._onStream.asObservable();\n  }\n  createPeer(stream, userId, initiator) {\n    const peer = new window[\"SimplePeer\"]({\n      initiator,\n      stream\n    });\n    peer.on('signal', data => {\n      this._onSignal.next(JSON.stringify(data));\n    });\n    peer.on('stream', data => {\n      this._onStream.next({\n        id: userId,\n        data: data\n      });\n    });\n    return peer;\n  }\n  createRemotePeer(initiator) {\n    const peer = new window[\"SimplePeer\"]({\n      initiator,\n      trickle: false\n    });\n    peer.on('signal', data => {\n      this._onSignal.next(JSON.stringify(data));\n    });\n    peer.on('stream', stream => {\n      this._onStream.next(stream);\n    });\n    return peer;\n  }\n  signalPeer(currentPeer, userId, signal, stream) {\n    const signalObject = JSON.parse(signal);\n    if (currentPeer) {\n      currentPeer.signal(signalObject);\n    } else {\n      currentPeer = this.createPeer(stream, userId, false);\n      currentPeer.signal(signalObject);\n    }\n  }\n  static #_ = this.ɵfac = function RtcService_Factory(t) {\n    return new (t || RtcService)();\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: RtcService,\n    factory: RtcService.ɵfac\n  });\n}","map":{"version":3,"mappings":"AACA,SAASA,OAAO,QAAQ,MAAM;;AAK9B,OAAM,MAAOC,UAAU;EADvBC;IAEY,cAAS,GAAG,IAAIF,OAAO,EAAU;IAClC,cAAS,GAAG,IAAI,CAACG,SAAS,CAACC,YAAY,EAAE;IAExC,cAAS,GAAG,IAAIJ,OAAO,EAAiB;IACzC,aAAQ,GAAG,IAAI,CAACK,SAAS,CAACD,YAAY,EAAE;;EAExCE,UAAU,CAACC,MAAwB,EAAEC,MAAc,EAAEC,SAAkB;IAC1E,MAAMC,IAAI,GAAG,IAAKC,MAAc,CAAC,YAAY,CAAC,CAAC;MAAEF,SAAS;MAAEF;IAAM,CAAE,CAAC;IAErEG,IAAI,CAACE,EAAE,CAAC,QAAQ,EAAGC,IAA2B,IAAI;MAChD,IAAI,CAACV,SAAS,CAACW,IAAI,CAACC,IAAI,CAACC,SAAS,CAACH,IAAI,CAAC,CAAC;IAC3C,CAAC,CAAC;IAEFH,IAAI,CAACE,EAAE,CAAC,QAAQ,EAAGC,IAAiB,IAAI;MACtC,IAAI,CAACR,SAAS,CAACS,IAAI,CAAC;QAAEG,EAAE,EAAET,MAAM;QAAEK,IAAI,EAAEA;MAAI,CAAE,CAAC;IACjD,CAAC,CAAC;IAEF,OAAOH,IAAI;EACf;EAEOQ,gBAAgB,CAACT,SAAkB;IACtC,MAAMC,IAAI,GAAG,IAAKC,MAAc,CAAC,YAAY,CAAC,CAAC;MAAEF,SAAS;MAAEU,OAAO,EAAE;IAAK,CAAE,CAAC;IAE7ET,IAAI,CAACE,EAAE,CAAC,QAAQ,EAAGC,IAA2B,IAAI;MAChD,IAAI,CAACV,SAAS,CAACW,IAAI,CAACC,IAAI,CAACC,SAAS,CAACH,IAAI,CAAC,CAAC;IAC3C,CAAC,CAAC;IAEFH,IAAI,CAACE,EAAE,CAAC,QAAQ,EAAGL,MAAmB,IAAI;MACxC,IAAI,CAACF,SAAS,CAACS,IAAI,CAACP,MAAM,CAAC;IAC7B,CAAC,CAAC;IAEF,OAAOG,IAAI;EACf;EAEOU,UAAU,CAACC,WAAgC,EAAEb,MAAc,EAAEc,MAAc,EAAEf,MAAW;IAC3F,MAAMgB,YAAY,GAAGR,IAAI,CAACS,KAAK,CAACF,MAAM,CAAC;IACvC,IAAID,WAAW,EAAE;MACbA,WAAW,CAACC,MAAM,CAACC,YAAY,CAAC;KACnC,MAAM;MACHF,WAAW,GAAG,IAAI,CAACf,UAAU,CAACC,MAAM,EAAEC,MAAM,EAAE,KAAK,CAAC;MACpDa,WAAW,CAACC,MAAM,CAACC,YAAY,CAAC;;EAExC;EAAC;qBA3CQtB,UAAU;EAAA;EAAA;WAAVA,UAAU;IAAAwB,SAAVxB,UAAU;EAAA","names":["Subject","RtcService","constructor","_onSignal","asObservable","_onStream","createPeer","stream","userId","initiator","peer","window","on","data","next","JSON","stringify","id","createRemotePeer","trickle","signalPeer","currentPeer","signal","signalObject","parse","factory"],"sourceRoot":"","sources":["D:\\Лабки\\VideoChat\\client\\src\\service\\rtc.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport { Subject } from \"rxjs\";\r\nimport * as SimplePeer from \"simple-peer\";\r\nimport { OnStreamEvent } from \"src/model/on-stream-event\";\r\n\r\n@Injectable()\r\nexport class RtcService {\r\n    private _onSignal = new Subject<string>();\r\n    public onSignal$ = this._onSignal.asObservable();\r\n\r\n    private _onStream = new Subject<OnStreamEvent>();\r\n    public onStream = this._onStream.asObservable();\r\n\r\n    public createPeer(stream: MediaStream|null, userId: string, initiator: boolean): SimplePeer.Instance {\r\n        const peer = new (window as any)[\"SimplePeer\"]({ initiator, stream });\r\n    \r\n        peer.on('signal', (data: SimplePeer.SignalData) => {\r\n          this._onSignal.next(JSON.stringify(data));\r\n        });\r\n    \r\n        peer.on('stream', (data: MediaStream) => {\r\n          this._onStream.next({ id: userId, data: data });\r\n        });\r\n    \r\n        return peer;\r\n    }\r\n\r\n    public createRemotePeer(initiator: boolean): SimplePeer.Instance {\r\n        const peer = new (window as any)[\"SimplePeer\"]({ initiator, trickle: false });\r\n    \r\n        peer.on('signal', (data: SimplePeer.SignalData) => {\r\n          this._onSignal.next(JSON.stringify(data));\r\n        });\r\n    \r\n        peer.on('stream', (stream: MediaStream) => {\r\n          this._onStream.next(stream);\r\n        });\r\n    \r\n        return peer;\r\n    }\r\n\r\n    public signalPeer(currentPeer: SimplePeer.Instance, userId: string, signal: string, stream: any) {\r\n        const signalObject = JSON.parse(signal);\r\n        if (currentPeer) {\r\n            currentPeer.signal(signalObject);\r\n        } else {\r\n            currentPeer = this.createPeer(stream, userId, false);\r\n            currentPeer.signal(signalObject);\r\n        }\r\n    }\r\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}