{"ast":null,"code":"import _asyncToGenerator from \"D:/\\u041B\\u0430\\u0431\\u043A\\u0438/VideoChat/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Subject } from \"rxjs\";\nimport { HubConnectionBuilder } from \"@microsoft/signalr\";\nimport constants from \"src/constants\";\nimport * as i0 from \"@angular/core\";\nexport class ConferenceService {\n  constructor() {\n    this._getParticipants = new Subject();\n    this.getParticipants$ = this._getParticipants.asObservable();\n    this._onToggleMicrophone = new Subject();\n    this.onToggleMicrophone$ = this._onToggleMicrophone.asObservable();\n    this._onConnected = new Subject();\n    this.onConnected$ = this._onConnected.asObservable();\n    this._onNewConnection = new Subject();\n    this.onNewConnection$ = this._onNewConnection.asObservable();\n    this._onRemoveConnection = new Subject();\n    this.onRemoveConnection$ = this._onRemoveConnection.asObservable();\n    this._onOffer = new Subject();\n    this.onOffer$ = this._onOffer.asObservable();\n    this._onAnswer = new Subject();\n    this.onAnswer$ = this._onAnswer.asObservable();\n  }\n  _initListeners() {\n    if (!this._connection) {\n      return;\n    }\n    this._connection.on(\"Connected\", () => this._onConnected.next());\n    this._connection.on(\"OnToggleMicrophone\", event => this._onToggleMicrophone.next(event));\n    this._connection.on(\"OnNewConnection\", participant => this._onNewConnection.next(participant));\n    this._connection.on(\"OnRemoveConnection\", participant => this._onRemoveConnection.next(participant));\n    this._connection.on('Offer', offerEvent => this._onOffer.next(offerEvent));\n    this._connection.on('Answer', answerEvent => this._onAnswer.next(answerEvent));\n  }\n  startConnection(userId, userName) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this._connection = new HubConnectionBuilder().withUrl(constants.serverUrl + \"/conference\").build();\n      yield _this._connection.start();\n      _this._initListeners();\n      _this._connection.send(\"Connect\", {\n        id: userId,\n        name: userName\n      });\n    })();\n  }\n  getParticipants() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      let participants = yield _this2._connection?.invoke(\"GetParticipants\");\n      if (participants) {\n        _this2._getParticipants.next(participants);\n      }\n    })();\n  }\n  sendOffer(userId, offer) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      yield _this3._connection?.send('Offer', userId, JSON.stringify(offer));\n    })();\n  }\n  sendAnswer(userId, answer) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      yield _this4._connection?.send('Answer', userId, JSON.stringify(answer));\n    })();\n  }\n  static #_ = this.ɵfac = function ConferenceService_Factory(t) {\n    return new (t || ConferenceService)();\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ConferenceService,\n    factory: ConferenceService.ɵfac,\n    providedIn: \"root\"\n  });\n}","map":{"version":3,"mappings":"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","names":["Subject","HubConnectionBuilder","constants","ConferenceService","constructor","_getParticipants","asObservable","_onToggleMicrophone","_onConnected","_onNewConnection","_onRemoveConnection","_onOffer","_onAnswer","_initListeners","_connection","on","next","event","participant","offerEvent","answerEvent","startConnection","userId","userName","withUrl","serverUrl","build","start","send","id","name","getParticipants","participants","invoke","sendOffer","offer","JSON","stringify","sendAnswer","answer","factory","providedIn"],"sourceRoot":"","sources":["D:\\Лабки\\VideoChat\\client\\src\\service\\conference.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport { Participant } from \"src/model/participant\";\r\nimport { Subject } from \"rxjs\";\r\nimport { HubConnection, HubConnectionBuilder } from \"@microsoft/signalr\";\r\nimport constants from \"src/constants\";\r\nimport { ToggleMicroEvent } from \"src/model/toggle-micro\";\r\nimport { OfferEvent } from \"src/model/offer-event\";\r\nimport { AnswerEvent } from \"src/model/answer-event\";\r\n\r\n@Injectable({ providedIn: \"root\" })\r\nexport class ConferenceService {\r\n    private _connection?: HubConnection;\r\n    \r\n    private _getParticipants = new Subject<Participant[]>()\r\n    public getParticipants$ = this._getParticipants.asObservable();\r\n\r\n    private _onToggleMicrophone = new Subject<ToggleMicroEvent>();\r\n    public onToggleMicrophone$ = this._onToggleMicrophone.asObservable();\r\n\r\n    private _onConnected = new Subject<void>();\r\n    public onConnected$ = this._onConnected.asObservable();\r\n\r\n    private _onNewConnection = new Subject<Participant>();\r\n    public onNewConnection$ = this._onNewConnection.asObservable();\r\n\r\n    private _onRemoveConnection = new Subject<Participant>();\r\n    public onRemoveConnection$ = this._onRemoveConnection.asObservable();\r\n\r\n    private _onOffer = new Subject<OfferEvent>();\r\n    public onOffer$ = this._onOffer.asObservable();\r\n\r\n    private _onAnswer = new Subject<AnswerEvent>();\r\n    public onAnswer$ = this._onAnswer.asObservable();\r\n\r\n    private _initListeners(): void {\r\n        if (!this._connection) {\r\n            return;\r\n        }\r\n        this._connection.on(\"Connected\", () => this._onConnected.next());\r\n        this._connection.on(\"OnToggleMicrophone\",\r\n            (event: ToggleMicroEvent) => this._onToggleMicrophone.next(event));\r\n        this._connection.on(\"OnNewConnection\",\r\n            (participant: Participant) => this._onNewConnection.next(participant));\r\n        this._connection.on(\"OnRemoveConnection\",\r\n            (participant: Participant) => this._onRemoveConnection.next(participant));\r\n        this._connection.on('Offer', (offerEvent: OfferEvent) => this._onOffer.next(offerEvent));\r\n        this._connection.on('Answer', (answerEvent: AnswerEvent) => this._onAnswer.next(answerEvent));\r\n    }\r\n\r\n    public async startConnection(userId: string, userName: string) {\r\n        this._connection = new HubConnectionBuilder()\r\n            .withUrl(constants.serverUrl + \"/conference\").build()\r\n        await this._connection.start();\r\n        this._initListeners();\r\n        this._connection.send(\"Connect\", { id: userId, name: userName });\r\n    }\r\n\r\n    public async getParticipants(): Promise<void> {\r\n        let participants = await this._connection?.invoke<Participant[]>(\"GetParticipants\");\r\n        if (participants) {\r\n            this._getParticipants.next(participants);\r\n        }\r\n    }\r\n\r\n    async sendOffer(userId: string, offer: RTCSessionDescriptionInit) {\r\n        await this._connection?.send('Offer', userId, JSON.stringify(offer));\r\n    }\r\n\r\n    async sendAnswer(userId: string, answer: RTCSessionDescriptionInit) {\r\n        await this._connection?.send('Answer', userId, JSON.stringify(answer));\r\n    }\r\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}